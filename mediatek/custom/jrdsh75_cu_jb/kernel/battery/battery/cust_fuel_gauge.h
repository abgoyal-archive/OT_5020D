#include <mach/mt_typedefs.h>

#define FGAUGE_VOLTAGE_FACTOR           2.44 // mV
#define FGAUGE_CURRENT_FACTOR           6.25 // uV/Rsns
#define FGAUGE_CURRENT_OFFSET_FACTOR    1.56 // uV/Rsns
#define FGAUGE_CAR_FACTOR               6.25 // uV/Rsns
#define FGAUGE_RSNS_FACTOR              0.02 // Ohm

//#define COMPASATE_OCV                   80 // mV for evb
#define COMPASATE_OCV                   40 // mV for phone

#define BATTERY_VOLTAGE_MINIMUM         3400
#define BATTERY_VOLTAGE_MAXIMUM         4200

#define BATTERY_CAPACITY_MAXIMUM        1383

#define TEMPERATURE_T0                  110
#define TEMPERATURE_T1                  0
#define TEMPERATURE_T2                  25
#define TEMPERATURE_T3                  50
#define TEMPERATURE_T                   255 // This should be fixed, never change the value

//#define BATT_CAPACITY                   1280
#define BATT_CAPACITY                   1395

#define ENABLE_SW_COULOMB_COUNTER       0 // 1 is enable, 0 is disable
//#define ENABLE_SW_COULOMB_COUNTER       1 // 1 is enable, 0 is disable

//#define FG_CURRENT_OFFSET_DISCHARGING 	31
#define FG_CURRENT_OFFSET_DISCHARGING 	0

#define FG_RESISTANCE 	20

#define FG_METER_RESISTANCE 	0
//#define FG_METER_RESISTANCE 	540 // current meter

//#define MAX_BOOTING_TIME_FGCURRENT	5*6 // 5 seconds, 6 points = 1s
#define MAX_BOOTING_TIME_FGCURRENT	1*10 // 10s

#if defined(CONFIG_POWER_EXT)
//#define OCV_BOARD_COMPESATE	32 //mV 
#define OCV_BOARD_COMPESATE	72 //mV 
#define R_FG_BOARD_BASE		1000
#define R_FG_BOARD_SLOPE	1000 //slope
#else
//#define OCV_BOARD_COMPESATE	0 //mV 
//#define OCV_BOARD_COMPESATE	48 //mV 
//#define OCV_BOARD_COMPESATE	25 //mV 
#define OCV_BOARD_COMPESATE	0 //mV 
#define R_FG_BOARD_BASE		1000
#define R_FG_BOARD_SLOPE	1000 //slope
//#define R_FG_BOARD_SLOPE	1057 //slope
//#define R_FG_BOARD_SLOPE	1075 //slope
#endif

#define Q_MAX_POS_50	1383
#define Q_MAX_POS_25	1395
#define Q_MAX_POS_0	1303
#define Q_MAX_NEG_10	1258

#define Q_MAX_POS_50_H_CURRENT	1358
#define Q_MAX_POS_25_H_CURRENT	1365
#define Q_MAX_POS_0_H_CURRENT	1257
#define Q_MAX_NEG_10_H_CURRENT	1050

#define R_FG_VALUE 				20 // mOhm, base is 20
#define CURRENT_DETECT_R_FG	100  //10mA

#define OSR_SELECT_7			0

#define CAR_TUNE_VALUE			91 //1.00

/////////////////////////////////////////////////////////////////////
// <DOD, Battery_Voltage> Table
/////////////////////////////////////////////////////////////////////
typedef struct _BATTERY_PROFILE_STRUC
{
    kal_int32 percentage;
    kal_int32 voltage;
} BATTERY_PROFILE_STRUC, *BATTERY_PROFILE_STRUC_P;

typedef enum
{
    T1_0C,
    T2_25C,
    T3_50C
} PROFILE_TEMPERATURE;

// T0 -10C
BATTERY_PROFILE_STRUC battery_profile_t0[] =
{
{0 , 4173},
{2 , 4163},
{3 , 4138},
{5 , 4113},
{6 , 4089},
{8 , 4071},
{10 , 4052},
{11 , 4032},
{13 , 4014},
{14 , 3998},
{16 , 3986},
{17 , 3976},
{19 , 3967},
{21 , 3959},
{22 , 3950},
{24 , 3941},
{25 , 3931},
{27 , 3921},
{29 , 3911},
{30 , 3900},
{32 , 3888},
{33 , 3878},
{35 , 3868},
{37 , 3858},
{38 , 3849},
{40 , 3841},
{41 , 3833},
{43 , 3826},
{45 , 3820},
{46 , 3815},
{48 , 3810},
{49 , 3805},
{51 , 3801},
{52 , 3797},
{54 , 3794},
{56 , 3791},
{57 , 3788},
{59 , 3785},
{60 , 3783},
{62 , 3781},
{64 , 3780},
{65 , 3778},
{67 , 3777},
{68 , 3775},
{70 , 3774},
{72 , 3771},
{73 , 3768},
{75 , 3764},
{76 , 3759},
{78 , 3753},
{79 , 3747},
{81 , 3740},
{83 , 3731},
{84 , 3720},
{86 , 3712},
{87 , 3706},
{89 , 3701},
{91 , 3697},
{92 , 3695},
{94 , 3691},
{95 , 3681},
{97 , 3652},
{98 , 3597},
{99 , 3535},
{99 , 3485},
{100 , 3442},
{100 , 3409},
{100 , 3381},
{100 , 3359},
{100 , 3343},
{100 , 3330},
{100 , 3319},
{100 , 3311},
{100 , 3302},
{100 , 3295},
{100 , 3289},
{100 , 3287},
{100 , 3285},
{100 , 3282},
{100 , 3279},
{100 , 3275},
{100 , 3271},
{100 , 3268},
{100 , 3264},
{100 , 3260},
{100 , 3256},
{100 , 3252},
{100 , 3248},
{100 , 3241},
{100 , 3236},
{100 , 3230}
};      
        
// T1 0C
BATTERY_PROFILE_STRUC battery_profile_t1[] =
{
{0 , 4174},
{2 , 4161},
{3 , 4134},
{5 , 4115},
{6 , 4100},
{8 , 4086},
{9 , 4075},
{11 , 4063},
{12 , 4048},
{14 , 4033},
{15 , 4017},
{17 , 4003},
{18 , 3991},
{20 , 3982},
{21 , 3974},
{23 , 3966},
{25 , 3957},
{26 , 3948},
{28 , 3939},
{29 , 3929},
{31 , 3920},
{32 , 3909},
{34 , 3897},
{35 , 3884},
{37 , 3873},
{38 , 3862},
{40 , 3853},
{41 , 3844},
{43 , 3836},
{44 , 3828},
{46 , 3823},
{48 , 3816},
{49 , 3811},
{51 , 3807},
{52 , 3804},
{54 , 3799},
{55 , 3795},
{57 , 3793},
{58 , 3789},
{60 , 3787},
{61 , 3783},
{63 , 3781},
{64 , 3779},
{66 , 3778},
{67 , 3776},
{69 , 3775},
{71 , 3774},
{72 , 3772},
{74 , 3769},
{75 , 3766},
{77 , 3761},
{78 , 3756},
{80 , 3749},
{81 , 3740},
{83 , 3730},
{84 , 3720},
{86 , 3706},
{87 , 3700},
{89 , 3696},
{91 , 3694},
{92 , 3692},
{94 , 3689},
{95 , 3685},
{97 , 3663},
{98 , 3601},
{100 , 3505},
{100 , 3338},
{100 , 3250},
{100 , 3205},
{100 , 3178},
{100 , 3165},
{100 , 3160},
{100 , 3155},
{100 , 3148},
{100 , 3140},
{100 , 3131},
{100 , 3121},
{100 , 3111},
{100 , 3099},
{100 , 3087},
{100 , 3075},
{100 , 3060},
{100 , 3045},
{100 , 3032},
{100 , 3017},
{100 , 3002},
{100 , 2987},
{100 , 2972},
{100 , 2957},
{100 , 2941},
{100 , 2928}
};

// T2 25C
BATTERY_PROFILE_STRUC battery_profile_t2[] =
{
{0 , 4185},
{1 , 4182},
{3 , 4166},
{4 , 4152},
{6 , 4138},
{7 , 4124},
{9 , 4110},
{10 , 4097},
{11 , 4085},
{13 , 4073},
{14 , 4061},
{16 , 4049},
{17 , 4037},
{19 , 4024},
{20 , 4013},
{22 , 4001},
{23 , 3991},
{24 , 3981},
{26 , 3973},
{27 , 3964},
{29 , 3955},
{30 , 3945},
{32 , 3936},
{33 , 3929},
{34 , 3920},
{36 , 3911},
{37 , 3901},
{39 , 3889},
{40 , 3875},
{42 , 3861},
{43 , 3848},
{44 , 3839},
{46 , 3833},
{47 , 3824},
{49 , 3820},
{50 , 3815},
{52 , 3810},
{53 , 3805},
{54 , 3801},
{56 , 3797},
{57 , 3793},
{59 , 3789},
{60 , 3786},
{62 , 3784},
{63 , 3780},
{65 , 3778},
{66 , 3776},
{67 , 3774},
{69 , 3771},
{70 , 3769},
{72 , 3766},
{73 , 3764},
{75 , 3761},
{76 , 3756},
{77 , 3750},
{79 , 3744},
{80 , 3739},
{82 , 3731},
{83 , 3721},
{85 , 3711},
{86 , 3698},
{87 , 3688},
{89 , 3685},
{90 , 3684},
{92 , 3682},
{93 , 3681},
{95 , 3678},
{96 , 3660},
{97 , 3606},
{99 , 3524},
{100 , 3399},
{100 , 3218},
{100 , 3180},
{100 , 3152},
{100 , 3140},
{101 , 3127},
{100 , 3114},
{100 , 3094},
{100 , 3082},
{100 , 3083},
{100 , 3082},
{100 , 3079},
{100 , 3076},
{100 , 3072},
{100 , 3067},
{100 , 3060},
{100 , 3055},
{100 , 3049},
{100 , 3041},
{100 , 3034},
{100 , 3027}
}; 

// T3 50C
BATTERY_PROFILE_STRUC battery_profile_t3[] =
{
{0 , 4189},
{1 , 4187},
{3 , 4170},
{4 , 4156},
{6 , 4142},
{7 , 4128},
{9 , 4113},
{10 , 4100},
{12 , 4088},
{13 , 4075},
{14 , 4061},
{16 , 4049},
{17 , 4037},
{19 , 4027},
{20 , 4015},
{22 , 4003},
{23 , 3993},
{25 , 3982},
{26 , 3972},
{27 , 3963},
{29 , 3953},
{30 , 3944},
{32 , 3934},
{33 , 3926},
{35 , 3917},
{36 , 3908},
{38 , 3900},
{39 , 3888},
{40 , 3877},
{42 , 3864},
{43 , 3851},
{45 , 3841},
{46 , 3833},
{48 , 3826},
{49 , 3819},
{51 , 3814},
{52 , 3809},
{53 , 3804},
{55 , 3799},
{56 , 3795},
{58 , 3791},
{59 , 3787},
{61 , 3783},
{62 , 3780},
{64 , 3777},
{65 , 3774},
{66 , 3770},
{68 , 3767},
{69 , 3762},
{71 , 3755},
{72 , 3746},
{74 , 3744},
{75 , 3740},
{77 , 3734},
{78 , 3727},
{79 , 3722},
{81 , 3717},
{82 , 3708},
{84 , 3698},
{85 , 3689},
{87 , 3675},
{88 , 3668},
{90 , 3667},
{91 , 3667},
{92 , 3665},
{94 , 3662},
{95 , 3654},
{97 , 3620},
{98 , 3557},
{100 , 3461},
{100 , 3294},
{100 , 3124},
{100 , 3091},
{100 , 3077},
{100 , 3070},
{100 , 3060},
{100 , 3062},
{100 , 3060},
{100 , 3057},
{100 , 3052},
{100 , 3046},
{100 , 3036},
{100 , 3029},
{100 , 3022},
{100 , 3015},
{100 , 3005},
{100 , 2997},
{100 , 2989},
{100 , 2981},
{100 , 2972},
{100 , 2964}
};              

// battery profile for actual temperature. The size should be the same as T1, T2 and T3
BATTERY_PROFILE_STRUC battery_profile_temperature[] =
{
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0}
};    

/////////////////////////////////////////////////////////////////////
// <Rbat, Battery_Voltage> Table
/////////////////////////////////////////////////////////////////////
typedef struct _R_PROFILE_STRUC
{
    kal_int32 resistance; // Ohm
    kal_int32 voltage;
} R_PROFILE_STRUC, *R_PROFILE_STRUC_P;

// T0 -10C
R_PROFILE_STRUC r_profile_t0[] =
{
{458 , 4173},
{458 , 4163},
{480 , 4138},
{510 , 4113},
{533 , 4089},
{563 , 4071},
{588 , 4052},
{598 , 4032},
{600 , 4014},
{600 , 3998},
{600 , 3986},
{605 , 3976},
{610 , 3967},
{618 , 3959},
{623 , 3950},
{625 , 3941},
{628 , 3931},
{630 , 3921},
{630 , 3911},
{630 , 3900},
{628 , 3888},
{628 , 3878},
{623 , 3868},
{623 , 3858},
{623 , 3849},
{625 , 3841},
{625 , 3833},
{625 , 3826},
{625 , 3820},
{630 , 3815},
{635 , 3810},
{638 , 3805},
{640 , 3801},
{643 , 3797},
{648 , 3794},
{650 , 3791},
{650 , 3788},
{648 , 3785},
{650 , 3783},
{653 , 3781},
{660 , 3780},
{665 , 3778},
{673 , 3777},
{680 , 3775},
{690 , 3774},
{698 , 3771},
{708 , 3768},
{723 , 3764},
{735 , 3759},
{750 , 3753},
{765 , 3747},
{785 , 3740},
{808 , 3731},
{820 , 3720},
{843 , 3712},
{875 , 3706},
{908 , 3701},
{955 , 3697},
{1030 , 3695},
{1130 , 3691},
{1270 , 3681},
{1483 , 3652},
{1498 , 3597},
{1358 , 3535},
{1230 , 3485},
{1110 , 3442},
{1040 , 3409},
{970 , 3381},
{910 , 3359},
{868 , 3343},
{840 , 3330},
{810 , 3319},
{818 , 3311},
{783 , 3302},
{780 , 3295},
{730 , 3289},
{733 , 3287},
{735 , 3285},
{738 , 3282},
{740 , 3279},
{743 , 3275},
{743 , 3271},
{745 , 3268},
{748 , 3264},
{750 , 3260},
{755 , 3256},
{755 , 3252},
{775 , 3248},
{763 , 3241},
{765 , 3236},
{765 , 3230}
};

// T1 0C
R_PROFILE_STRUC r_profile_t1[] =
{
{343 , 4174},
{343 , 4161},
{345 , 4134},
{348 , 4115},
{350 , 4100},
{355 , 4086},
{363 , 4075},
{373 , 4063},
{378 , 4048},
{383 , 4033},
{380 , 4017},
{375 , 4003},
{373 , 3991},
{375 , 3982},
{380 , 3974},
{380 , 3966},
{383 , 3957},
{383 , 3948},
{385 , 3939},
{383 , 3929},
{388 , 3920},
{383 , 3909},
{375 , 3897},
{365 , 3884},
{360 , 3873},
{353 , 3862},
{353 , 3853},
{350 , 3844},
{350 , 3836},
{348 , 3828},
{350 , 3823},
{348 , 3816},
{350 , 3811},
{350 , 3807},
{358 , 3804},
{358 , 3799},
{358 , 3795},
{363 , 3793},
{360 , 3789},
{365 , 3787},
{365 , 3783},
{365 , 3781},
{365 , 3779},
{368 , 3778},
{370 , 3776},
{373 , 3775},
{375 , 3774},
{378 , 3772},
{383 , 3769},
{385 , 3766},
{388 , 3761},
{393 , 3756},
{400 , 3749},
{405 , 3740},
{410 , 3730},
{420 , 3720},
{410 , 3706},
{418 , 3700},
{425 , 3696},
{443 , 3694},
{470 , 3692},
{510 , 3689},
{573 , 3685},
{678 , 3663},
{830 , 3601},
{1193 , 3505},
{865 , 3338},
{650 , 3250},
{545 , 3205},
{485 , 3178},
{433 , 3165},
{440 , 3160},
{448 , 3155},
{458 , 3148},
{468 , 3140},
{483 , 3131},
{493 , 3121},
{508 , 3111},
{520 , 3099},
{535 , 3087},
{555 , 3075},
{570 , 3060},
{580 , 3045},
{598 , 3032},
{613 , 3017},
{628 , 3002},
{640 , 2987},
{653 , 2972},
{673 , 2957},
{678 , 2941},
{693 , 2928}
}; 

// T2 25C
R_PROFILE_STRUC r_profile_t2[] =
{
{198 , 4185},
{198 , 4182},
{198 , 4166},
{200 , 4152},
{205 , 4138},
{205 , 4124},
{205 , 4110},
{205 , 4097},
{208 , 4085},
{213 , 4073},
{213 , 4061},
{213 , 4049},
{218 , 4037},
{215 , 4024},
{218 , 4013},
{215 , 4001},
{215 , 3991},
{218 , 3981},
{225 , 3973},
{223 , 3964},
{225 , 3955},
{228 , 3945},
{228 , 3936},
{235 , 3929},
{238 , 3920},
{238 , 3911},
{240 , 3901},
{228 , 3889},
{215 , 3875},
{200 , 3861},
{195 , 3848},
{193 , 3839},
{188 , 3833},
{180 , 3824},
{185 , 3820},
{185 , 3815},
{188 , 3810},
{188 , 3805},
{188 , 3801},
{188 , 3797},
{188 , 3793},
{188 , 3789},
{190 , 3786},
{193 , 3784},
{190 , 3780},
{190 , 3778},
{190 , 3776},
{190 , 3774},
{188 , 3771},
{188 , 3769},
{185 , 3766},
{188 , 3764},
{190 , 3761},
{190 , 3756},
{185 , 3750},
{188 , 3744},
{193 , 3739},
{200 , 3731},
{200 , 3721},
{205 , 3711},
{198 , 3698},
{180 , 3688},
{180 , 3685},
{188 , 3684},
{195 , 3682},
{210 , 3681},
{248 , 3678},
{345 , 3660},
{428 , 3606},
{588 , 3524},
{1005 , 3399},
{548 , 3218},
{505 , 3180},
{390 , 3152},
{360 , 3140},
{323 , 3127},
{340 , 3114},
{295 , 3094},
{233 , 3082},
{233 , 3083},
{233 , 3082},
{235 , 3079},
{238 , 3076},
{243 , 3072},
{243 , 3067},
{240 , 3060},
{250 , 3055},
{258 , 3049},
{258 , 3041},
{263 , 3034},
{268 , 3027}
}; 

// T3 50C
R_PROFILE_STRUC r_profile_t3[] =
{
{173 , 4189},
{173 , 4187},
{170 , 4170},
{170 , 4156},
{173 , 4142},
{173 , 4128},
{170 , 4113},
{170 , 4100},
{170 , 4088},
{173 , 4075},
{170 , 4061},
{170 , 4049},
{170 , 4037},
{173 , 4027},
{175 , 4015},
{173 , 4003},
{173 , 3993},
{173 , 3982},
{175 , 3972},
{178 , 3963},
{180 , 3953},
{183 , 3944},
{180 , 3934},
{188 , 3926},
{188 , 3917},
{193 , 3908},
{198 , 3900},
{193 , 3888},
{188 , 3877},
{178 , 3864},
{163 , 3851},
{158 , 3841},
{155 , 3833},
{155 , 3826},
{153 , 3819},
{153 , 3814},
{155 , 3809},
{153 , 3804},
{153 , 3799},
{155 , 3795},
{158 , 3791},
{155 , 3787},
{155 , 3783},
{158 , 3780},
{163 , 3777},
{163 , 3774},
{160 , 3770},
{163 , 3767},
{160 , 3762},
{160 , 3755},
{150 , 3746},
{153 , 3744},
{155 , 3740},
{155 , 3734},
{150 , 3727},
{153 , 3722},
{160 , 3717},
{163 , 3708},
{163 , 3698},
{173 , 3689},
{153 , 3675},
{140 , 3668},
{145 , 3667},
{153 , 3667},
{155 , 3665},
{170 , 3662},
{235 , 3654},
{315 , 3620},
{403 , 3557},
{605 , 3461},
{755 , 3294},
{338 , 3124},
{260 , 3091},
{220 , 3077},
{223 , 3070},
{175 , 3060},
{175 , 3062},
{178 , 3060},
{178 , 3057},
{180 , 3052},
{195 , 3046},
{185 , 3036},
{190 , 3029},
{195 , 3022},
{195 , 3015},
{198 , 3005},
{200 , 2997},
{205 , 2989},
{210 , 2981},
{208 , 2972},
{213 , 2964}
}; 

// r-table profile for actual temperature. The size should be the same as T1, T2 and T3
R_PROFILE_STRUC r_profile_temperature[] =
{
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0}
};     


int fgauge_get_saddles(void);
BATTERY_PROFILE_STRUC_P fgauge_get_profile(kal_uint32 temperature);

int fgauge_get_saddles_r_table(void);
R_PROFILE_STRUC_P fgauge_get_profile_r_table(kal_uint32 temperature);

